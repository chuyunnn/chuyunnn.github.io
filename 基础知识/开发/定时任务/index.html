<!DOCTYPE html>
<html lang=en>
<head>
    <!-- so meta -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="HandheldFriendly" content="True">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5" />
    <meta name="description" content="定时任务就是让系统在指定的时间或按照一定的周期自动执行某个任务，不需要人工触发  比如每天凌晨自动备份数据、每隔 10 分钟检查一次订单状态等  因为有这些任务：  自动执行，不需要人一直盯着。 在特定时间执行，比如凌晨访问量低时做统计 周期性执行，比如每小时同步一次数据 保证任务执行的准确性和及时性，避免人工操作的遗漏或延迟  所以需要引入定时任务。也就是说，它可以用于：  数据备份、日志清理、">
<meta property="og:type" content="article">
<meta property="og:title" content="定时任务">
<meta property="og:url" content="http://example.com/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E5%BC%80%E5%8F%91/%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="定时任务就是让系统在指定的时间或按照一定的周期自动执行某个任务，不需要人工触发  比如每天凌晨自动备份数据、每隔 10 分钟检查一次订单状态等  因为有这些任务：  自动执行，不需要人一直盯着。 在特定时间执行，比如凌晨访问量低时做统计 周期性执行，比如每小时同步一次数据 保证任务执行的准确性和及时性，避免人工操作的遗漏或延迟  所以需要引入定时任务。也就是说，它可以用于：  数据备份、日志清理、">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="2026-01-23T05:36:10.000Z">
<meta property="article:modified_time" content="2026-01-23T06:22:18.539Z">
<meta property="article:author" content="John Doe">
<meta property="article:tag" content="实例">
<meta name="twitter:card" content="summary">
    
    
      
        
          <link rel="shortcut icon" href="/images/favicon.ico">
        
      
      
        
          <link rel="icon" type="image/png" href="/images/favicon-192x192.png" sizes="192x192">
        
      
      
        
          <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
        
      
    
    <!-- title -->
    <title>定时任务</title>
    <!-- async scripts -->
    <!-- Google Analytics -->


    <!-- Umami Analytics -->


    <!-- styles -->
    
<link rel="stylesheet" href="/css/style.css">

    <!-- persian styles -->
    
    <!-- rss -->
    
    
	<!-- mathjax -->
	
<meta name="generator" content="Hexo 7.3.0"></head>

<body class="max-width mx-auto px3 ltr">
    
      <div id="header-post">
  <a id="menu-icon" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="menu-icon-tablet" href="#" aria-label="Menu"><i class="fa-solid fa-bars fa-lg"></i></a>
  <a id="top-icon-tablet" href="#" aria-label="Top" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');" style="display:none;"><i class="fa-solid fa-chevron-up fa-lg"></i></a>
  <span id="menu">
    <span id="nav">
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a target="_blank" rel="noopener" href="http://github.com/probberechts">Projects</a></li><!--
     -->
      </ul>
    </span>
    <br/>
    <span id="actions">
      <ul>
        
        
        <li><a class="icon" aria-label="Next post" href="/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E5%BC%80%E5%8F%91/Cacheable%E6%B3%A8%E8%A7%A3/"><i class="fa-solid fa-chevron-right" aria-hidden="true" onmouseover="$('#i-next').toggle();" onmouseout="$('#i-next').toggle();"></i></a></li>
        
        <li><a class="icon" aria-label="Back to top" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up" aria-hidden="true" onmouseover="$('#i-top').toggle();" onmouseout="$('#i-top').toggle();"></i></a></li>
        <li><a class="icon" aria-label="Share post" href="#"><i class="fa-solid fa-share-alt" aria-hidden="true" onmouseover="$('#i-share').toggle();" onmouseout="$('#i-share').toggle();" onclick="$('#share').toggle();return false;"></i></a></li>
      </ul>
      <span id="i-prev" class="info" style="display:none;">Previous post</span>
      <span id="i-next" class="info" style="display:none;">Next post</span>
      <span id="i-top" class="info" style="display:none;">Back to top</span>
      <span id="i-share" class="info" style="display:none;">Share post</span>
    </span>
    <br/>
    <div id="share" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://example.com/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E5%BC%80%E5%8F%91/%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1/"><i class="fab fa-facebook " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://example.com/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E5%BC%80%E5%8F%91/%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1/&text=定时任务"><i class="fab fa-twitter " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://example.com/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E5%BC%80%E5%8F%91/%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1/&title=定时任务"><i class="fab fa-linkedin " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://example.com/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E5%BC%80%E5%8F%91/%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1/&is_video=false&description=定时任务"><i class="fab fa-pinterest " aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=定时任务&body=Check out this article: http://example.com/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E5%BC%80%E5%8F%91/%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1/"><i class="fa-solid fa-envelope " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://example.com/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E5%BC%80%E5%8F%91/%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1/&title=定时任务"><i class="fab fa-get-pocket " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://example.com/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E5%BC%80%E5%8F%91/%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1/&title=定时任务"><i class="fab fa-reddit " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://example.com/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E5%BC%80%E5%8F%91/%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1/&title=定时任务"><i class="fab fa-stumbleupon " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://example.com/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E5%BC%80%E5%8F%91/%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1/&title=定时任务"><i class="fab fa-digg " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://example.com/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E5%BC%80%E5%8F%91/%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1/&name=定时任务&description="><i class="fab fa-tumblr " aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://example.com/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E5%BC%80%E5%8F%91/%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1/&t=定时任务"><i class="fab fa-hacker-news " aria-hidden="true"></i></a></li>
</ul>

    </div>
    
    
      <div id="toc">
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E4%BE%8B%EF%BC%9A%E4%BD%BF%E7%94%A8-Scheduled%E6%B3%A8%E8%A7%A3%E5%AE%9E%E7%8E%B0%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1"><span class="toc-number">1.</span> <span class="toc-text">实例：使用@Scheduled注解实现定时任务</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%E5%88%86%E6%9E%90"><span class="toc-number">2.</span> <span class="toc-text">知识点分析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#cron%E8%A1%A8%E8%BE%BE%E5%BC%8F"><span class="toc-number">2.1.</span> <span class="toc-text">cron表达式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A1%A8%E8%BE%BE%E5%BC%8F%E5%A2%9E%E5%BC%BA%EF%BC%88spring5-3%E4%B9%8B%E5%90%8E%EF%BC%89"><span class="toc-number">2.2.</span> <span class="toc-text">表达式增强（spring5.3之后）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%9A%E4%B8%AA%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1%E7%9A%84%E6%89%A7%E8%A1%8C%E9%A1%BA%E5%BA%8F"><span class="toc-number">2.3.</span> <span class="toc-text">多个定时任务的执行顺序</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1%E7%9A%84%E4%BC%98%E5%85%88%E7%BA%A7"><span class="toc-number">2.4.</span> <span class="toc-text">定时任务的优先级</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B9%B6%E8%A1%8C%E8%B0%83%E5%BA%A6%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1"><span class="toc-number">2.5.</span> <span class="toc-text">并行调度定时任务</span></a></li></ol></li></ol>
      </div>
    
  </span>
</div>

    
    <div class="content index py4 ">
        
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">
  <header>
    
    <h1 class="posttitle p-name" itemprop="name headline">
        定时任务
    </h1>



    <div class="meta">
      <span class="author p-author h-card" itemprop="author" itemscope itemtype="http://schema.org/Person">
        <span class="p-name" itemprop="name">John Doe</span>
      </span>
      
    <div class="postdate">
      
        <time datetime="2026-01-23T05:36:10.000Z" class="dt-published" itemprop="datePublished">2026-01-23</time>
        
      
    </div>


      
    <div class="article-category">
        <i class="fa-solid fa-archive"></i>
        <a class="category-link" href="/categories/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/">基础知识</a> › <a class="category-link" href="/categories/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E5%BC%80%E5%8F%91/">开发</a>
    </div>


      
    <div class="article-tag">
        <i class="fa-solid fa-tag"></i>
        <a class="p-category" href="/tags/%E5%AE%9E%E4%BE%8B/" rel="tag">实例</a>
    </div>


    </div>
  </header>
  

  <div class="content e-content" itemprop="articleBody">
    <p>定时任务就是让系统在<strong>指定的时间</strong>或<strong>按照一定的周期</strong>自动执行某个任务，不需要人工触发</p>
<ul>
<li>比如每天凌晨自动备份数据、每隔 10 分钟检查一次订单状态等</li>
</ul>
<p>因为有这些任务：</p>
<ol>
<li>自动执行，不需要人一直盯着。</li>
<li>在特定时间执行，比如凌晨访问量低时做统计</li>
<li>周期性执行，比如每小时同步一次数据</li>
<li>保证任务执行的准确性和及时性，避免人工操作的遗漏或延迟</li>
</ol>
<p>所以需要引入定时任务。也就是说，它可以用于：</p>
<ul>
<li>数据备份、日志清理、数据同步、定时发送、超时关闭、缓存刷新、系统状态监控</li>
</ul>
<h2 id="实例：使用-Scheduled注解实现定时任务"><a href="#实例：使用-Scheduled注解实现定时任务" class="headerlink" title="实例：使用@Scheduled注解实现定时任务"></a>实例：使用<code>@Scheduled</code>注解实现定时任务</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 采用定时器方案，每天5:15分刷新站点地图，确保数据的一致性</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Scheduled(cron = &quot;0 15 5 * * ?&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">autoRefreshCache</span><span class="params">()</span> &#123;</span><br><span class="line">    log.info(<span class="string">&quot;开始刷新sitemap.xml的url地址，避免出现数据不一致问题!&quot;</span>);</span><br><span class="line">    refreshSitemap();</span><br><span class="line">    log.info(<span class="string">&quot;刷新完成！&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>🌟 需要在启动类添加注解<code>@EnableScheduling</code>来开启定时任务</p>
<h2 id="知识点分析"><a href="#知识点分析" class="headerlink" title="知识点分析"></a>知识点分析</h2><h3 id="cron表达式"><a href="#cron表达式" class="headerlink" title="cron表达式"></a><code>cron</code>表达式</h3><p>是一个字符串，以5个或6个空格隔开，分为6个或7个域，每个域代表一个含义</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1  Seconds Minutes Hours DayofMonth Month DayofWeek Year</span><br><span class="line">2  Seconds Minutes Hours DayofMonth Month DayofWeek</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th align="center">符号</th>
<th align="center">含义</th>
<th align="center">适用域</th>
<th align="center">示例</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><code>*</code></td>
<td align="center">匹配任意值</td>
<td align="center">所有</td>
<td align="center"><code>0 * * * * ?</code> → 每分钟触发</td>
</tr>
<tr>
<td align="center"><code>?</code></td>
<td align="center">匹配任意值（避免 <strong>DayOfMonth&#x2F;DayOfWeek</strong> 冲突）</td>
<td align="center">DayOfMonth, DayOfWeek</td>
<td align="center"><code>0 0 15 20 * ?</code> → <strong>每月 20 日 15 点触发，不管星期几</strong></td>
</tr>
<tr>
<td align="center"><code>-</code></td>
<td align="center">范围匹配</td>
<td align="center">所有</td>
<td align="center"><code>0 5-20 * * * ?</code> → <strong>5-20 分每分钟触发</strong></td>
</tr>
<tr>
<td align="center"><code>/</code></td>
<td align="center">间隔触发</td>
<td align="center">所有</td>
<td align="center"><code>0 5/20 * * * ?</code> → <strong>5 分触发，之后每 20 分钟一次</strong></td>
</tr>
<tr>
<td align="center"><code>,</code></td>
<td align="center">枚举值</td>
<td align="center">所有</td>
<td align="center"><code>0 5,20 * * * ?</code> → <strong>5 分和 20 分各触发一次</strong></td>
</tr>
<tr>
<td align="center"><code>L</code></td>
<td align="center">最后一个</td>
<td align="center">DayOfMonth, DayOfWeek</td>
<td align="center"><code>0 0 0 ? * 5L</code> → 每月最后一个周四触发</td>
</tr>
<tr>
<td align="center"><code>W</code></td>
<td align="center"><strong>最近工作日</strong></td>
<td align="center">DayOfMonth</td>
<td align="center"><code>0 0 0 5W * ?</code> → <strong>5 日附近的最近工作日</strong>触发</td>
</tr>
<tr>
<td align="center"><code>LW</code></td>
<td align="center">最后一个工作日</td>
<td align="center">DayOfMonth</td>
<td align="center"><code>0 0 0 LW * ?</code> → 每月最后一个工作日触发</td>
</tr>
<tr>
<td align="center"><code>#</code></td>
<td align="center">第 N 个星期几</td>
<td align="center">DayOfWeek</td>
<td align="center"><code>0 0 0 ? * 4#2</code> → <strong>每月第 2 个周三触</strong>发</td>
</tr>
</tbody></table>
<h3 id="表达式增强（spring5-3之后）"><a href="#表达式增强（spring5-3之后）" class="headerlink" title="表达式增强（spring5.3之后）"></a>表达式增强（spring5.3之后）</h3><ol>
<li>宏指令</li>
</ol>
<p>最主要的特点就是增加了一些宏指令</p>
<table>
<thead>
<tr>
<th align="center">宏</th>
<th align="center">表达式</th>
<th align="center">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center"><code>@yearly</code></td>
<td align="center"><code>0 0 0 1 1 *</code></td>
<td align="center">每年的 1 月 1 号 0 点执行一次</td>
</tr>
<tr>
<td align="center"><code>@monthly</code></td>
<td align="center"><code>0 0 0 1 * *</code></td>
<td align="center">每月一次</td>
</tr>
<tr>
<td align="center"><code>@weekly</code></td>
<td align="center"><code>0 0 0 * * 0</code></td>
<td align="center">每周一次</td>
</tr>
<tr>
<td align="center"><code>@daily</code> 或 <code>@midnight</code></td>
<td align="center"><code>0 0 0 * * *</code></td>
<td align="center">每天一次</td>
</tr>
<tr>
<td align="center"><code>@hourly</code></td>
<td align="center"><code>0 0 * * * *</code></td>
<td align="center">每小时一次</td>
</tr>
</tbody></table>
<ol start="2">
<li>最后 X 天</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&quot;0 0 0 L * *&quot; 每月的最后一天零点</span><br><span class="line">&quot;0 0 0 L-3 * *&quot; 每月的最后三天零点</span><br><span class="line">&quot;0 0 0 * * 5L&quot; 每月最后的周五零点</span><br><span class="line">&quot;0 0 0 * * THUL&quot; 每月最后的周三零点</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>每月的第几天支持工作日W的定义</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&quot;0 0 0 1W * *&quot; 每月的第一个工作日零时</span><br><span class="line">&quot;0 0 0 LW * *&quot; 每月的最后一个工作日零时</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>第几周的星期几</li>
</ol>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&quot;0 0 0 ? * 5#2&quot; 每月第二周的星期五零时</span><br><span class="line">&quot;0 0 0 ? * MON#1&quot; 每月第一周的星期一零时</span><br></pre></td></tr></table></figure>

<ul>
<li><p><code>MON</code>：表示 <code>Monday</code> 周一（TUE &#x3D; 周二、WED &#x3D; 周三、THU &#x3D; 周四、FRI &#x3D; 周五、SAT &#x3D; 周六、SUN &#x3D; 周日）</p>
</li>
<li><p><code>#1</code>：是增强版 Cron 的特殊语法，<code>#</code> 后面跟数字表示「第 N 个」， <code>#1</code> 就是「第一个」</p>
</li>
</ul>
<h3 id="多个定时任务的执行顺序"><a href="#多个定时任务的执行顺序" class="headerlink" title="多个定时任务的执行顺序"></a>多个定时任务的执行顺序</h3><p>默认情况下，多个定时任务串行执行</p>
<ul>
<li>一个任务阻塞，其他任务都会受到影响</li>
</ul>
<h3 id="定时任务的优先级"><a href="#定时任务的优先级" class="headerlink" title="定时任务的优先级"></a>定时任务的优先级</h3><p>实际并无明显的优先级关系</p>
<h3 id="并行调度定时任务"><a href="#并行调度定时任务" class="headerlink" title="并行调度定时任务"></a>并行调度定时任务</h3><ol>
<li><p>在启动类Application上添加注解<code>@EnableAsync</code>开启异步调用</p>
</li>
<li><p>在计划任务中加上<code>@Async</code></p>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableAsync</span>  <span class="comment">// 核心开关：开启异步功能</span></span><br><span class="line"><span class="meta">@EnableScheduling</span></span><br><span class="line"><span class="meta">@SpringBootApplication</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">QuickMediaApplication</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        SpringApplication.run(QuickMediaApplication.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Scheduled(cron = &quot;0/1 * * * * ?&quot;)</span></span><br><span class="line"><span class="meta">@Async</span>  <span class="comment">// 标记该任务为异步执行</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sc1</span><span class="params">()</span> &#123;</span><br><span class="line">    System.out.println(Thread.currentThread().getName() + <span class="string">&quot; | sc1 &quot;</span> + System.currentTimeMillis());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<p>💡 但是！这种默认配置是有风险的</p>
<p>Spring 异步任务的默认线程池是 <code>SimpleAsyncTaskExecutor</code>，它：</p>
<ul>
<li><strong>每次调用都创建新线程</strong>，不会复用线程</li>
<li>如果定时任务里写了<strong>死循环</strong>，或者任务执行时间远大于调度间隔（比如每秒调度一次，但任务执行需要10秒），就会不断创建新线程</li>
<li>Linux 单进程的线程数是有上限的（用 <code>ulimit -u</code> 可以查看），当线程数超过上限时，进程会因为无法创建新线程而崩溃</li>
</ul>
<p>所以！！可以自定义线程池来规避风险</p>
<p><code>asyncTaskExecutor()</code>线程池配置：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="keyword">public</span> AsyncTaskExecutor <span class="title function_">asyncTaskExecutor</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="type">ThreadPoolTaskExecutor</span> <span class="variable">executor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ThreadPoolTaskExecutor</span>();</span><br><span class="line">    executor.setThreadNamePrefix(<span class="string">&quot;yhh-schedule-&quot;</span>);</span><br><span class="line">    executor.setMaxPoolSize(<span class="number">10</span>); <span class="comment">// 最大线程数</span></span><br><span class="line">    executor.setCorePoolSize(<span class="number">3</span>); <span class="comment">// 核心线程数</span></span><br><span class="line">    executor.setQueueCapacity(<span class="number">0</span>); <span class="comment">// 任务队列容量</span></span><br><span class="line">    executor.setRejectedExecutionHandler(<span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>.AbortPolicy());</span><br><span class="line">    <span class="keyword">return</span> executor;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Scheduled(cron = &quot;0/1 * * * * ?&quot;)</span></span><br><span class="line"><span class="meta">@Async</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sc1</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">    System.out.println(Thread.currentThread().getName() + <span class="string">&quot; | sc1 &quot;</span> + System.currentTimeMillis());</span><br><span class="line">    <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">        Thread.sleep(<span class="number">1000</span> * <span class="number">5</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<ul>
<li>有新任务时，先看<strong>核心线程</strong>是否有空闲 → 有空就直接执行</li>
<li>核心线程都忙 → 把任务放到<strong>任务队列</strong>里排队</li>
<li>队列满了 → 才会创建<strong>非核心线程</strong>（直到达到最大线程数）</li>
<li>线程数到最大值 + 队列满 → 触发<strong>拒绝策略</strong></li>
</ul>
<hr>

  </div>
</article>



        
          <div id="footer-post-container">
  <div id="footer-post">

    <div id="nav-footer" style="display: none">
      <ul>
        
          <li><a href="/">Home</a></li>
        
          <li><a href="/about/">About</a></li>
        
          <li><a href="/archives/">Writing</a></li>
        
          <li><a target="_blank" rel="noopener" href="http://github.com/probberechts">Projects</a></li>
        
      </ul>
    </div>

    
    
      <div id="toc-footer" style="display: none">
        <ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E4%BE%8B%EF%BC%9A%E4%BD%BF%E7%94%A8-Scheduled%E6%B3%A8%E8%A7%A3%E5%AE%9E%E7%8E%B0%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1"><span class="toc-number">1.</span> <span class="toc-text">实例：使用@Scheduled注解实现定时任务</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%E5%88%86%E6%9E%90"><span class="toc-number">2.</span> <span class="toc-text">知识点分析</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#cron%E8%A1%A8%E8%BE%BE%E5%BC%8F"><span class="toc-number">2.1.</span> <span class="toc-text">cron表达式</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A1%A8%E8%BE%BE%E5%BC%8F%E5%A2%9E%E5%BC%BA%EF%BC%88spring5-3%E4%B9%8B%E5%90%8E%EF%BC%89"><span class="toc-number">2.2.</span> <span class="toc-text">表达式增强（spring5.3之后）</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%9A%E4%B8%AA%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1%E7%9A%84%E6%89%A7%E8%A1%8C%E9%A1%BA%E5%BA%8F"><span class="toc-number">2.3.</span> <span class="toc-text">多个定时任务的执行顺序</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1%E7%9A%84%E4%BC%98%E5%85%88%E7%BA%A7"><span class="toc-number">2.4.</span> <span class="toc-text">定时任务的优先级</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B9%B6%E8%A1%8C%E8%B0%83%E5%BA%A6%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1"><span class="toc-number">2.5.</span> <span class="toc-text">并行调度定时任务</span></a></li></ol></li></ol>
      </div>
    

    <div id="share-footer" style="display: none">
      <ul>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.facebook.com/sharer.php?u=http://example.com/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E5%BC%80%E5%8F%91/%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1/"><i class="fab fa-facebook fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://twitter.com/share?url=http://example.com/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E5%BC%80%E5%8F%91/%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1/&text=定时任务"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.linkedin.com/shareArticle?url=http://example.com/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E5%BC%80%E5%8F%91/%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1/&title=定时任务"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://pinterest.com/pin/create/bookmarklet/?url=http://example.com/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E5%BC%80%E5%8F%91/%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1/&is_video=false&description=定时任务"><i class="fab fa-pinterest fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" href="mailto:?subject=定时任务&body=Check out this article: http://example.com/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E5%BC%80%E5%8F%91/%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1/"><i class="fa-solid fa-envelope fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://getpocket.com/save?url=http://example.com/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E5%BC%80%E5%8F%91/%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1/&title=定时任务"><i class="fab fa-get-pocket fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://reddit.com/submit?url=http://example.com/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E5%BC%80%E5%8F%91/%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1/&title=定时任务"><i class="fab fa-reddit fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.stumbleupon.com/submit?url=http://example.com/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E5%BC%80%E5%8F%91/%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1/&title=定时任务"><i class="fab fa-stumbleupon fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://digg.com/submit?url=http://example.com/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E5%BC%80%E5%8F%91/%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1/&title=定时任务"><i class="fab fa-digg fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="http://www.tumblr.com/share/link?url=http://example.com/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E5%BC%80%E5%8F%91/%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1/&name=定时任务&description="><i class="fab fa-tumblr fa-lg" aria-hidden="true"></i></a></li>
  <li><a class="icon" target="_blank" rel="noopener" href="https://news.ycombinator.com/submitlink?u=http://example.com/%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/%E5%BC%80%E5%8F%91/%E5%AE%9A%E6%97%B6%E4%BB%BB%E5%8A%A1/&t=定时任务"><i class="fab fa-hacker-news fa-lg" aria-hidden="true"></i></a></li>
</ul>

    </div>

    <div id="actions-footer">
        <a id="menu" class="icon" href="#" onclick="$('#nav-footer').toggle();return false;"><i class="fa-solid fa-bars fa-lg" aria-hidden="true"></i> Menu</a>
        
          <a id="toc" class="icon" href="#" onclick="$('#toc-footer').toggle();return false;"><i class="fa-solid fa-list fa-lg" aria-hidden="true"></i> TOC</a>
        
        <a id="share" class="icon" href="#" onclick="$('#share-footer').toggle();return false;"><i class="fa-solid fa-share-alt fa-lg" aria-hidden="true"></i> Share</a>
        <a id="top" style="display:none" class="icon" href="#" onclick="$('html, body').animate({ scrollTop: 0 }, 'fast');"><i class="fa-solid fa-chevron-up fa-lg" aria-hidden="true"></i> Top</a>
    </div>

  </div>
</div>

        
        <footer id="footer">
  <div class="footer-left">
    Copyright &copy;
    
    
    2016-2026
    John Doe
  </div>
  <div class="footer-right">
    <nav>
      <ul>
        <!--
       --><li><a href="/">Home</a></li><!--
     --><!--
       --><li><a href="/about/">About</a></li><!--
     --><!--
       --><li><a href="/archives/">Writing</a></li><!--
     --><!--
       --><li><a target="_blank" rel="noopener" href="http://github.com/probberechts">Projects</a></li><!--
     -->
      </ul>
    </nav>
  </div>
</footer>

    </div>
    <!-- styles -->



  <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" crossorigin="anonymous" onload="this.onload=null;this.rel='stylesheet'"/>


    <!-- jquery -->

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" crossorigin="anonymous"></script>




<!-- clipboard -->

  
    <script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.7/clipboard.min.js" crossorigin="anonymous"></script>
  
  <script type="text/javascript">
  $(function() {
    // copy-btn HTML
    var btn = "<span class=\"btn-copy tooltipped tooltipped-sw\" aria-label=\"Copy to clipboard!\">";
    btn += '<i class="fa-regular fa-clone"></i>';
    btn += '</span>';
    // mount it!
    $(".highlight table").before(btn);
    var clip = new ClipboardJS('.btn-copy', {
      text: function(trigger) {
        return Array.from(trigger.nextElementSibling.querySelectorAll('.code')).reduce((str,it)=>str+it.innerText+'\n','')
      }
    });
    clip.on('success', function(e) {
      e.trigger.setAttribute('aria-label', "Copied!");
      e.clearSelection();
    })
  })
  </script>


<script src="/js/main.js"></script>

<!-- search -->

<!-- Baidu Analytics -->

<!-- Cloudflare Analytics -->

<!-- Disqus Comments -->

<!-- utterances Comments -->

</body>
</html>
